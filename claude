최근 onpremise 에 적용되는 VA 또는 SWG 가 one-arm 형태로 동작하길 원하는 요구사항이 있었음. 그런 고객들은 대부분 대형고객임.

one-arm 모드는 일반적인 inline 과 달리 L3 형태로 동작하며, 장비가 NIC 하나 혹은 둘(이중화를 위해 양팔벌려서 서로 다른 l3 switch 에서 연결?) 의 인터페이스를 제공하고, IP 를 가지고 해당 IP 로 들어오는 패킷에 대해 swg 나 복호화를 수행하며, 나가는 트래픽은 들어온쪽 라우터로 나가는 (보통 mac swapping 이라는 기술로 src mac 을 dst mac 으로 바꿔서 전송) 형태로 동작한다.

현재 VA/SWG 는 인라인 모드를 기본으로 만들어졌으나, inline 처리하는 코드와 세션 hijacking 을 위한 ct 인터페이스 부분을 수정하여, V10 장비에서는 옵션에 따라 one-arm 으로도 동작할수 있도록 구현해 본다.

다만 one-arm 으로 동작할때는 이미 L3 형태로 동작하는 구조라 기존의 체인구간 제공은 안되며 (체인 모드일때 one-arm 지원 못함), 미러링 트래픽만 제공될수 있다.
미러 장비에서 flowsync port 로 차단 메시지 받는것은 가능하도록 구현하자.
(l2 inline 장비가 아니라 비대칭 트래픽 처리를 위한 flowsync 는 제대로 적용 안될수도 있는데, 이부분은 추후 고민해본다.)

그리고, 이 모드로 동작시킬때는, 기존 미러모드 적용때 처럼 내부 ip 대역 (client ip 대역) 지정이 되어야 한다. 이전에는 인터페이스로 상향/하향을 구분했지만, One-arm 이 되면 당연히 상/하향을 장비에서 자동으로 구분해줄수 없기 때문이다.

SYS_ONE_ARM_MODE="1" 로 해당 모드가 동작될것이고, 이 상황에서는 체인모드 (ACTIVE_INLINE 모드) 가 무시되며 (싱글 모드로만 동작), LLCF 등 인라인 적용을 위해 구현되었던 기능들이 모두 무시된다.
인터페이스는, SYS_IF_RECV_ALL 로 인터페이스를 지정 (여러개 가능) 할것이고, 이 인터페이스들에는 IP 가 부여되어야 한다. (일단, SYS_IF_RECV_ALL 인터페이스 지정은 수작업으로 base.cfg 에 잡아줘야 할것이다.)

UI 에서는 SYS_ONE_ARM_MODE 가 설정되면,
1. 인터페이스 표현할때 RECV_ALL 의 port 표현을 신경써줘야 하며
2. 미러모드처럼 client ip 대역 입력하는 창을 제공해야 한다.

정도만 우선 처리해 주면 될것으로 보인다.

ONE_ARM 모드 초기 설정은 다음과 같이 진행되면 될듯 (CORE-489 클러스터 매니저와 유사)

sysmgr init onearm 형태로 뒤에 onearm 아규먼트를 줘서 ONE-ARM 세팅을 시작.

onearm 아규먼트를 가지고 init 이 되는 경우 sysmgr 5 번 단계에서 인터페이스를 입력받고 SYS_IF_RECV_ALL 로 해당 인터페이스를 지정한다. (여러개 입력받을수 있다. 보통 한개만 쓰게 되겠지만.. 최대 8 개 정도만 지원해도 될듯.) SYS_IF_RECV_ALL 설정 외에 Flowsync 나 MON 등 다른 인터페이스도 입력이 가능해야 한다.

이때, MGMT 인터페이스를 RECV_ALL 인터페이스로 사용하는 경우도 있으므로 이를 고려해야 하며 (별도로 PBR 용 NIC/IP 를 세팅하지 않고 MGMT 를 통해 트래픽을 보내고 받는 경우), MGMT 외의 인터페이스를 지정하는 경우 해당 NIC 들의 IP/NETMASK 세팅이 가능하도록 한다. (UI 에서 입력시 문제만 없으면 될듯. )

ONE_ARM세팅으로 진행되면 설정 파일에 아래 설정이 필히 들어가야 한다.

SYS_ONE_ARM_MODE="1"

bypass_mgr 은 구동되지 않아야 하며, 이에 따른 크리티컬 에러등의 오류 알람도 발생하지 않아야 한다.

옵션
첨부 파일
활동
모두
댓글
작업 기록
이력
활동
오름 차순 - 내림 차순으로 하려면 클릭
영구연결
wsyang
양우석 님이 댓글을 추가했습니다 - 2025-02-21 4:00 오후
엔진 구현은 완료되어 One-arm 으로 동작되는거 까지 확인되었습니다. 기존 inline 방식에 비해 성능적으로 떨어질만한 구현은 아니기 때문에, one-arm 방식 적용을 요구하는 사이트에 적극적으로 대응하셔도 될것 같습니다.

현재 상태에서는 몇가지 수작업으로 설정을 하셔야 합니다.

예를 들어 eth2 NIC 에 IP 를 잡아서 one-arm 으로 동작시키겠다고 하면,
UI 에서 eth2 에 ip 설정하고 , SYS_ONE_ARM_MODE="1" 과 SYS_IF_RECV_ALL="eth2" 처럼 수작업으로 base.conf 설정한후 재시작 하시면 됩니다.

그리고 client ip 대역을 넣어줘야 하는데 (one-arm 이라 UL/DL 트래픽을 따로 구분이 안되니), UI 에서 client ip 입력하는 메뉴가 노출되기 전까지는 /usr/local/ts/conf/net_tag.def 에

cat /usr/local/ts/conf/net_tag.def
65534 172.24.2.0/24
이런식으로 넣어주고, CFG_NET_TAGID_CLIENTS="65534" 를 적용해 주셔야 합니다. (물론 미러모드처럼 UI 에서 제공해주면 이 세팅은 UI 에 내용만 넣어주시면 자동 반영됩니다.)

다음 release 전까지 UI 작업도 진행해주시기 바랍니다.

영구연결
wsyang
양우석 님이 댓글을 추가했습니다 - 2025-02-21 4:05 오후
내부 openstack SFC 환경에서 one-arm 에 대한 개발자 테스트는 수행되었지만, 실제 라우팅 환경에서.. 그리고 flowsync 포트로 차단 패킷을 받는 형태 등의 테스트는 해보지 못한 상황입니다. (그리고 계측기 테스트가 가능할지는..)

한대의 VA 장비를 라우터 등에서 PBR 로 꺽어서 one-arm 으로 구성하고, 그 장비의 mirror port 와 flowsync port 에 SWG 미러장비를 하나 붙여서 차단까지 정상적으로 되는지 확인해 보는 테스트는 해봐야 할것 같아요.

영구연결
yjpark
박영재 님이 댓글을 추가했습니다 - 2025-02-27 3:26 오후
UI 에서는 SYS_ONE_ARM_MODE 가 설정되면,
1. RECV_ALL 포트 표현
2. Client IP 대역 메뉴 활성

테스트 시 설정이 번거로울 듯 하여 2번 Client IP 대역 메뉴만 노출되게 우선 처리하여 push 해뒀습니다.

RECV_ALL 포트 표현은 차후 다시 보도록 하겠습니다.

영구연결
wsyang
양우석 님이 댓글을 추가했습니다 - 2025-03-13 1:09 오후
예전 클러스터 매니저 작업 내용을 보니 ONE_ARM 모드 설정하는것과 유사해서 내용을 거의 퍼와서 본문에 추가하였습니다. (Flowsync 와 MON 포트를 지정할수 있어야 하는것 외의는 거의 동일)
시간 나실때 V10 에 작업 부탁합니다. 오승룡

영구연결
osr
오승룡 님이 댓글을 추가했습니다 - 2025-04-01 10:41 오전
o command: sysmgr init onearm 

   처리 내역
   . base.cfg 설정:
     SYS_ONE_ARM_MODE="1"

     SYS_IF_RECV_ALL
     SYS_IF_SEND_MON : optional
     SYS_IF_FS : optional

영구연결
yjpark
박영재 님이 댓글을 추가했습니다 - 2025-04-24 9:53 오전
양우석 전무님!

One-arm 모드 시 트래픽 화살표 위아래 둘 다 표시만 해주면 된다고 하셨던 걸로 기억하는데 보충 설명 해주시면 바로 작업 진행하려고 합니다.

영구연결
wsyang
양우석 님이 댓글을 추가했습니다 - 2025-04-24 10:54 오전
네. 그렇게 표현해주시면 되겠습니다.

영구연결
yakim
김영아 님이 댓글을 추가했습니다 - 2025-04-24 1:39 오후


이렇게 양쪽에서 들어오는 화살표 모양으로 표시하면 될까요? 양우석

영구연결
wsyang
양우석 님이 댓글을 추가했습니다 - 2025-04-24 1:58 오후
들어오는 화살표가 이상하네요. 그냥 양방향 나가는 화살표로 표현하는게 나을거 같아요

 

영구연결
yakim
김영아 님이 댓글을 추가했습니다 - 2025-04-24 2:04 오후


네 그럼 이렇게 하겠습니다. 

영구연결
yakim
김영아 님이 댓글을 추가했습니다 - 2025-04-24 3:57 오후
v10 master, v10.0.2 push 했습니다. 
